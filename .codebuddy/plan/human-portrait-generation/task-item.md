# 实施计划

## 真人写真生成功能 - 任务清单

- [ ] 1. 修改后端 API 支持双图片输入
   - 修改 `/generate` 接口，接收两个文件字段：`main_file`（人物照片）和 `style_file`（风格参考图）
   - 添加图片格式校验（支持 jpg/png/webp）
   - 添加图片大小校验（单张不超过 10MB）
   - 添加缺失图片的错误提示处理
   - _需求：1.1、1.2、1.3、1.4_

- [ ] 2. 修改 Prompt 适配真人写真场景
   - 将现有宠物相关的 prompt 替换为真人写真 prompt
   - prompt 应包含人像摄影、美肤、光影、专业写真等关键词
   - 确保 prompt 描述能保持人物面部特征辨识度
   - _需求：2.1、2.3_

- [ ] 3. 调整字节 API 调用参数
   - 修改 API 调用逻辑，传递主体图和风格参考图的 base64 数据
   - 调整 `req_key` 以适配风格迁移/图生图场景
   - 设置合适的重绘强度参数（0.4-0.6）以保留人物特征
   - 如 API 不支持双图，则将风格描述融入 prompt
   - _需求：2.2、3.1、3.2、3.3、3.4_

- [ ] 4. 修改前端上传组件支持双图片
   - 创建两个独立的图片上传区域组件
   - 第一个区域标注"上传人物照片"，第二个标注"上传风格参考图"
   - 为每个上传区域添加图片预览功能
   - 添加删除/重新上传按钮
   - _需求：4.1、4.2、4.4_

- [ ] 5. 修改前端表单提交逻辑
   - 修改 FormData 构造，包含 `main_file` 和 `style_file` 两个字段
   - 添加提交前校验：两张图片都必须上传
   - 未上传完整时点击生成按钮显示提示信息
   - _需求：4.3、5.1、5.2_

- [ ] 6. 优化前端请求状态处理
   - 请求过程中显示加载状态（loading spinner 或进度提示）
   - 请求过程中禁用提交按钮，防止重复提交
   - 后端返回错误时显示友好的错误提示信息
   - _需求：5.3、5.4_

- [ ] 7. 完善生成结果展示页面
   - 清晰展示生成的写真图片
   - 添加下载按钮，支持一键下载生成的图片
   - 添加"重新生成"按钮，可使用相同输入再次生成
   - _需求：6.1、6.2、6.3_

- [ ] 8. 添加边界情况处理
   - 前端或后端添加大尺寸图片压缩逻辑
   - 设置合理的请求超时时间（建议 60 秒）
   - 添加超时错误的友好提示
   - _需求：技术考量 - 边界情况处理_
